<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
	<style>
		* {
		  padding: 0;
		  margin: 0;
		}
  
		body {
		  width: 100vw;
		  height: 100vh;
		  display: flex;
		  justify-content: center;
		  align-items: center;
		  background-color: rgb(16, 80, 136);
		}
	  </style>
</head>
<body>
	<canvas id="canvas"  border: 2px solid #FFF;
	position: absolute;
	margin :auto;
	top:0;
	right:0;
	left:0;
	bottom:0;></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.
	// load sounds
let hit = new Audio();
let wall = new Audio();
let player1audio = new Audio();
let player2audio = new Audio();

hit.src = "sounds/hit.mp3";
wall.src = "sounds/wall.mp3";
player1audio.src = "sounds/comScore.mp3";
player2audio.src = "sounds/userScore.mp3";

let player1;
let player2;
let ball;
const moveSpeed = 4;
const paddleWidth = 10;
const paddleHeight = 100;
let score =0;
const borderWidth = 20;
const margin = 10;

/**
 * The ball that bounces back and forth
 */
class Ball {
    constructor(id, x, y) {
        this.id = id;
        this.startX = app.width/2;
        this.startY = app.height/2;
        this.width = 8;
        this.height = 8;
		this.radius = 10;
		this.color = 'white';
        this.resetPosition();

    }

    resetPosition() {
        this.x = this.startX;
        this.y = this.startY;
        this.speed = 3;
        let angle = Math.random() * Math.PI * 2;
        this.velx = 3;
		this.velY =3;
	
    }

    move() {
        this.x += this.velx;
        this.y += this.velY;
    }

    collisionDetect(player, ball) {
      ball.top = ball.y;
      ball.right = ball.x + ball.width;
      ball.bottom = ball.y + ball.height;
      ball.left = ball.x;

      player.top = player.y ;
      player.bottom = player.y + player.height;
      player.left = player.x;
      player.right = player.x + player.width;
        
      return ball.left < player.right && ball.top < player.bottom && ball.right > player.left && ball.bottom > player.top;
    }

    update(time) {
        // this.move();
        this.x += this.velx;
        this.y += this.velY;

        // this.checkForPaddleBounces();
        let player = (ball.x + ball.radius < app.width / 2) ? player1 : player2

        if (ball.collisionDetect(player, ball)) {
            let angle = 0;
            hit.play()
           
            if (this.y < (player.y + player.height / 2)) {
                angle = -1 * Math.PI / 4;
            }
         
            else if (this.y > (player.y + player.height / 2)) {
                angle = Math.PI / 4;
            }

		
			let direction = (player === app.getNode('player1') ? 1 : -1)
            this.velx = direction * this.speed * Math.cos(angle);
            this.velY = this.speed * Math.sin(angle);

           
            this.speed += 0.1;
        }
        if (this.y + this.height >= app.height || this.y <= 0) {
			this.velY = -this.velY;
			wall.play();
        }

		
      
        if (this.x > app.width) {
            app.getNode('player1').score++;
            score += 1
            console.log('player1 win!!!!', "score: " + player1.score );
		
			player1audio.play();
            app.restartMatch();
        }
  
        else if (this.x + this.width < 0) {
            app.getNode('player2').score++;
            score += 1
            console.log('player2 win!!!!', "score: " + player2.score );
			
			player2audio.play()
            app.restartMatch();
        }
        
    }
}

//  Declare Paddle class
class Pad {
    constructor(id, x, y, upKey, downKey) {
        this.id = id;
        this.startX = x;
        this.startY = y;
        this.width = paddleWidth;
        this.height = paddleHeight;
        this.color = 'black';
        this.upKey = upKey;
        this.downKey = downKey;
        this.score = 0;
        this.resetPosition();
        this.eventListner();
    }

    resetPosition() {
        this.x = this.startX;
        this.y = this.startY;
        this.up = false;
        this.down = false;
    }

    eventListner() {
        document.addEventListener("keyup", (event) => this.keyboardEvent(event));
        document.addEventListener("keydown", (event) => this.keyboardEvent(event));
        
    }

    keyboardEvent(event) {
        if (event.type === "keydown") {
            if (event.key === this.upKey) {
                this.up = true;
            } else if (event.key === this.downKey) {
                this.down = true;
            }
        } else if (event.type === "keyup") {
            if (event.key === this.upKey) {
                this.up = false;
            } else if (event.key === this.downKey) {
                this.down = false;
            }
        }
    }

  update(time) {
        
        if (this.up) {
            this.y -= moveSpeed;
        }
        if (this.down) {
            this.y += moveSpeed;
        }

         let min = 0;
         let max = app.height - this.height;
         this.y = Math.min(Math.max(this.y, min), max);
    }

}

// resizing  canvas for bonus point

let canvas = document.querySelector("#canvas");
let context = canvas.getContext('2d');

// add window resize listener for updating canvas
  window.addEventListener('resize', resizeCanvas);
  

function resizeCanvas() {
    canvas.width = window.innerWidth;
     var x = window.innerWidth;
    canvas.height = window.innerHeight;
    var y = window.innerHeight;

    
    const scale = Math.min(canvas.width / app.width, canvas.height / app.height);
    const origin = {
        x: (canvas.width - app.width * scale) / 2,
        y: (canvas.height - app.height * scale) / 2
    };

    context.setTransform(scale, 0, 0, scale, origin.x, origin.y);
}

resizeCanvas();

  app.restartMatch = function() {
	ball.resetPosition();
	player1.resetPosition();
	player2.resetPosition();
  }

  app.reset = function() {
    this.nodes = [];
    this.nodes.push({
	  id : 'midline',
	  x  : app.width / 2 - (borderWidth) / 2,
	  y  : 0,
	  width  : borderWidth,
	  height : app.height,
	  color  : 'black',
	});
	this.nodes.push({
				id : 'top',
				x  : 0,
				y  : -borderWidth,
				width  : app.width,
				height : borderWidth,
				color  : 'black',
			});
			this.nodes.push({
				id : 'bottom',
				x  : 0,
				y  : app.height,
				width  : app.width,
				height : borderWidth,
				color  : 'black',
			});

			player1 = new Pad('player1', margin, app.height / 2 - (paddleHeight / 2), 'w', 's');
			player2 = new Pad('player2', app.width - margin - paddleWidth, app.height / 2 - (paddleHeight / 2), 'ArrowUp', 'ArrowDown');
			ball = new Ball('ball', app.width / 2 - (10 / 2), app.height / 2 - (10 / 2));

			this.nodes.push(player1);
			this.nodes.push(player2);
			this.nodes.push(ball);

			console.log('Game Restart.....');
		}

		
        app.onInit = function(){
			app.reset();
			app.initialised = true;
		};

	    app.togglePause = function() {
			app.paused = !app.paused;
			console.log("Game is Paused");
		}

		
		window.addEventListener("keyup", function(event) {
			if (event.code === 'Space') {
				app.togglePause();
			} else if (event.key === 'r') {
				app.reset();
			}
		});

		app.onUpdate = function(time){
			if (!app.initialised) {
				return;
			}

			if (!app.paused) {
				
				player1.update(time);
				player2.update(time);
				ball.update(time);
			}

		
			app.context.textAlign = 'left';
			app.context.fillText(`Score: ${player1.score}`, margin, margin * 2, app.width / 2);
			app.context.textAlign = 'right';
			app.context.fillText(`Score: ${player2.score}`, app.width - margin, margin * 2, app.width / 2);
		};
		
   </script>
</body>
</html>